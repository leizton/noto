{"lines":[{"id":"24C93563-7158-4F69-A8D1-785365419A0E","content":"vector\n","styles":[],"paragraphType":"title","attachments":[]},{"id":"785CEF66-7B53-4CD4-95E0-752B53CD3FE5","content":"\n","styles":[],"attachments":[]},{"id":"A070C42A-889A-43E3-ABC7-191AD3ABE095","content":"\n","styles":[],"attachments":[]},{"id":"BA7B1664-DCDC-4041-A4A8-0AE74E24D005","content":"#### constructor\n","styles":[],"attachments":[]},{"id":"E5F3D1F8-E631-4A61-9985-F797DEC1B30F","content":"￼\n","styles":[],"paragraphType":"body","attachments":[{"percentageWidth":0.625,"content":"cpp","caption":{"lines":[{"id":"3922CDA7-08E7-4C7A-AC81-362A99E163DF","content":"","styles":[],"attachments":[]}]},"type":"code","name":"E1CB22C5-0274-4EE5-BD6D-194E45CA03C6.","location":0}]},{"id":"0999AD1A-2585-4981-8021-E588B88FD6C0","content":"\n","styles":[],"attachments":[]},{"id":"D4861663-7DA8-47C9-97FA-574DFB74C186","content":"\n","styles":[],"attachments":[]},{"id":"DA59DB0F-0425-43DF-829D-9AF893DA99FC","content":"#### method\n","styles":[],"attachments":[]},{"id":"36B8F542-C464-4EF4-AACF-2DB8C6CCFDFA","content":"￼\n","styles":[],"paragraphType":"body","attachments":[{"percentageWidth":0.625,"content":"cpp","caption":{"lines":[{"id":"3922CDA7-08E7-4C7A-AC81-362A99E163DF","content":"","styles":[],"attachments":[]}]},"type":"code","name":"E1CB22C5-0274-4EE5-BD6D-194E45CA03C6. 3","location":0}]},{"id":"DCA59812-A6CF-4388-9D82-F2335003F0C1","content":"\n","styles":[],"attachments":[]},{"id":"5D953BA4-9BCC-4843-BFF3-4B19A0BB02B3","content":"\n","styles":[],"attachments":[]},{"id":"4C77E620-5AD6-4136-9ECD-5962BADAFD0E","content":"#### emplace_back\n","styles":[],"attachments":[]},{"id":"1EE38AC5-14D6-4EC4-B81C-D1C55BC76B98","content":"￼\n","styles":[],"paragraphType":"body","attachments":[{"percentageWidth":0.625,"content":"cpp","caption":{"lines":[{"id":"A38F4BCB-E51E-4049-BD66-3DBD1CD3CE9B","content":"template<class T, class Alloc>\n","styles":[],"attachments":[]},{"id":"8E131308-21A0-44B6-B0D0-D035B5FEABB7","content":"template<class... Args>\n","styles":[],"attachments":[]},{"id":"838132B3-15CD-4354-872D-297CBD9CA0D5","content":"void vector<T, Alloc>::emplace_back(Args &&... args) {\n","styles":[],"attachments":[]},{"id":"40C48557-6F23-40CF-8B8D-DF6DA13ABBFA","content":"  \/\/ _M_finish: 指向下一个写入位置的指针\n","styles":[],"attachments":[]},{"id":"C6EC7194-5BE5-4C69-A5FC-4A457F56B3C2","content":"  \/\/ _M_end_of_storage: 分配空间的end指针\n","styles":[],"attachments":[]},{"id":"8A12F71C-D260-4A89-A1FE-2113378C693B","content":"  if _M_impl._M_finish != _M_impl._M_end_of_storage\n","styles":[],"attachments":[]},{"id":"D2694B4A-86B2-459E-BEB4-1F5308A32B7D","content":"    _Alloc_traits::construct(_M_impl, _M_impl._M_finish, std::forward<Args>(args)...)\n","styles":[],"attachments":[]},{"id":"F4418A1B-030A-4773-AD39-534F61CFC549","content":"    _M_impl._M_finish++;\n","styles":[],"attachments":[]},{"id":"04020F00-508A-4A82-8E98-24AC2D8FCEF8","content":"  else\n","styles":[],"attachments":[]},{"id":"BE4F7DB4-505A-421F-A901-33508FA2388F","content":"    _M_realloc_insert(end(), std::forward<Args>(args)...)\n","styles":[],"attachments":[]},{"id":"95A37DDD-5D04-4D96-8CC4-CE4E819EC3AC","content":"}\n","styles":[],"attachments":[]},{"id":"2540615D-234D-4491-A892-1B508B062741","content":"\n","styles":[],"attachments":[]},{"id":"F724CC55-A681-414D-A95F-D07C7425EABE","content":"void vector<T, Alloc>::_M_realloc_insert(iterator pos, Args &&... args) {\n","styles":[],"attachments":[]},{"id":"DBA03593-1F4B-41CE-9F39-D07960BBEBFB","content":"  const size_t new_len = _M_check_len(n=1)  \/\/ new_len = size + max(size, n)\n","styles":[],"attachments":[]},{"id":"30CFB6A5-04B7-4FF9-A17C-0C966CCCB60E","content":"  const size_t idx = pos - begin()\n","styles":[],"attachments":[]},{"id":"7E397B56-F230-416D-82ED-AFB3AFE2CEC4","content":"  pointer old_start(_M_impl._M_start), old_finish(_M_impl._M_finish)\n","styles":[],"attachments":[]},{"id":"EB964D2E-99C8-48AD-8DCC-5480D6438DB4","content":"  pointer new_start(_M_allocate(new_len)), new_finish(new_start)\n","styles":[],"attachments":[]},{"id":"C0A914CB-5BCC-4F1A-AE27-929030E0D869","content":"  try {\n","styles":[],"attachments":[]},{"id":"C05E4708-210D-4C37-A371-C23C90B96260","content":"    \/\/ pos前插入\n","styles":[],"attachments":[]},{"id":"684C68A4-BB31-41F8-891A-2E366FEDE784","content":"    _Alloc_traits::construct(_M_impl, new_start+idx, std::forward<Args>(args)...)\n","styles":[],"attachments":[]},{"id":"C8D9A50B-4194-4C20-BC5B-B3E48AC0E1B1","content":"    new_finish = nullptr\n","styles":[],"attachments":[]},{"id":"EE2C7F13-8A9D-4989-B0DD-4906BC7592C4","content":"    \/\/ copy 旧元素，by copy_constructor\n","styles":[],"attachments":[]},{"id":"1C73CD95-7FE1-4B7A-943C-909C69AE3E87","content":"    if constexpr (_S_use_relocate()) {\n","styles":[],"attachments":[]},{"id":"5A97C934-90FA-42A2-93F2-43CF0712F6D1","content":"      \/\/ 同时还调用了析构\n","styles":[],"attachments":[]},{"id":"66C3340A-7B73-4268-91A2-09247708345C","content":"      \/\/ __traits::construct(__alloc, std::__addressof(*dst), *ori)\n","styles":[],"attachments":[]},{"id":"F74CC469-A19D-4F1A-A336-7F5B44A8CE14","content":"      \/\/ __traits::destroy(__alloc, std::__addressof(*ori))\n","styles":[],"attachments":[]},{"id":"CBEF53CA-FB3C-4F4F-A974-3CB3AF5ADDAC","content":"      \/\/ __traits = __gnu_cxx::__alloc_traits<_Allocator>\n","styles":[],"attachments":[]},{"id":"E5951115-271E-452A-A6B8-DBF2F760064E","content":"      new_finish = std::__relocate_a(old_start, pos.base(), new_start, _M_get_Tp_allocator())\n","styles":[],"attachments":[]},{"id":"3D006B21-5FF7-464E-A627-B8022094589E","content":"      new_finish++\n","styles":[],"attachments":[]},{"id":"DCE78EF0-DF40-4A7F-A5FE-8811F815E31D","content":"      new_finish = std::__relocate_a(pos.base(), old_finish, new_finish, _M_get_Tp_allocator())\n","styles":[],"attachments":[]},{"id":"D44BE417-C642-494E-BA6D-CA01E9C83E1D","content":"    }\n","styles":[],"attachments":[]},{"id":"A807686E-5D03-4F99-9B28-6C3BB3A2C32D","content":"    else {\n","styles":[],"attachments":[]},{"id":"705CF0AB-4F4F-49B3-8A09-71E787EAB942","content":"      \/\/ __traits::construct(alloc, std::__addressof(*dst), *ori)\n","styles":[],"attachments":[]},{"id":"40492296-8868-42C2-B28C-6413928B699B","content":"      \/\/ __traits = std::allocator_traits<_Allocator>\n","styles":[],"attachments":[]},{"id":"9F6C5ED5-F84F-46C9-9A86-8EE7E2D0F95B","content":"      new_finish = std::__uninitialized_move_if_noexcept_a(old_start, pos.base(), new_start, _M_get_Tp_allocator())\n","styles":[],"attachments":[]},{"id":"B443DBC9-0D79-4857-B109-CC540F50CDD8","content":"      new_finish++\n","styles":[],"attachments":[]},{"id":"6DB8398C-5DE4-4C6C-B73C-8F7968D73FD4","content":"      new_finish = std::__uninitialized_move_if_noexcept_a(pos.base(), old_finish, new_finish, _M_get_Tp_allocator())\n","styles":[],"attachments":[]},{"id":"4901E552-7E0F-49CB-B913-BF1B89E3BB99","content":"    }\n","styles":[],"attachments":[]},{"id":"CE306F65-DB17-4E71-A7A3-34409C8E4067","content":"  }\n","styles":[],"attachments":[]},{"id":"1F141FC8-6003-4C73-97BF-163D0A81FA97","content":"  catch(...) {\n","styles":[],"attachments":[]},{"id":"93DAF5A7-50CC-478B-B71A-A6B9DF61A5AD","content":"    if new_finish\n","styles":[],"attachments":[]},{"id":"9CED9B00-D92B-4882-926A-B93308748A5E","content":"      \/\/ 析构已经拷贝了的旧元素\n","styles":[],"attachments":[]},{"id":"4A22433C-ACF2-404C-81AD-674A95C39A8B","content":"      \/\/ 特别地，_Alloc_traits::construct失败时, new_finish == new_start，没有元素需要析构\n","styles":[],"attachments":[]},{"id":"319120F6-2280-4376-B987-8EBEE28A83BE","content":"      std::_Destory(new_start, new_finish, _M_get_Tp_allocator())\n","styles":[],"attachments":[]},{"id":"DC2C7AB7-3064-4461-990D-0A7A93791BDA","content":"    else\n","styles":[],"attachments":[]},{"id":"7C6A2C33-4F8B-49E9-A858-125E1E130349","content":"      \/\/ 没有拷贝时，仅析构新构造的元素\n","styles":[],"attachments":[]},{"id":"0D751F2F-1B60-43A1-BE04-E180AE14DF9B","content":"      _Alloc_traits::destory(_M_impl, new_start+idx)\n","styles":[],"attachments":[]},{"id":"4FE54EBB-FDF6-4B08-9E29-924FFA695E61","content":"    \/\/ 释放新开辟的空间\n","styles":[],"attachments":[]},{"id":"D1BF9B44-85CA-444A-92D3-8655708CF0A2","content":"    _M_deallocate(new_start, new_len)\n","styles":[],"attachments":[]},{"id":"69C9AAB2-047E-4E4E-811A-A49C96F7A65D","content":"    __throw_exception_again\n","styles":[],"attachments":[]},{"id":"50C6E95F-311F-4D20-9015-E5F229976D9C","content":"  }\n","styles":[],"attachments":[]},{"id":"A1CB6E4B-7182-4D87-A9C7-6697BFE99EB6","content":"  \/\/ 析构旧元素，并释放旧空间\n","styles":[],"attachments":[]},{"id":"D4840813-5DBB-44E5-89DE-14FF5ADE9609","content":"  if constexpr (!_S_use_relocate())\n","styles":[],"attachments":[]},{"id":"1C9700D4-8AC6-423B-93A8-58CFC19C28EB","content":"    std::_Destory(old_start, old_finish, _M_get_Tp_allocator())\n","styles":[],"attachments":[]},{"id":"42395ACE-5C79-4C91-A1DD-E97A0441B38E","content":"  _M_deallocate(old_start, _M_impl._M_end_of_storage - old_start)\n","styles":[],"attachments":[]},{"id":"B9638D56-A705-4512-A14B-E413C89720E7","content":"  \/\/\n","styles":[],"attachments":[]},{"id":"2DBDA6E9-55CB-4D15-8D74-240A8BDA9252","content":"  _M_impl.(_M_start, _M_finish, _M_end_of_storage) = (new_start, new_finish, new_start+new_len)\n","styles":[],"attachments":[]},{"id":"CDBA5E18-DBED-4F2D-8CE6-21AA912135F0","content":"}","styles":[],"attachments":[]}]},"type":"code","name":"E1CB22C5-0274-4EE5-BD6D-194E45CA03C6. 3 2","location":0}]},{"id":"0DF1B976-A564-433F-B1DE-AF96C47BEEFD","content":"\n","styles":[],"attachments":[]},{"id":"76C444EB-9A3E-4EAD-BD6F-5D17689DF091","content":"\n","styles":[],"attachments":[]},{"id":"A359C4FA-4B9E-4895-9BA7-43D7A232917E","content":"#### example\n","styles":[],"attachments":[]},{"id":"12C72F9C-C508-4AD0-8888-0DC0E52636D1","content":"￼","styles":[],"paragraphType":"body","attachments":[{"percentageWidth":0.625,"content":"cpp","caption":{"lines":[{"id":"47AC64C7-EE91-4C0C-8DD5-0940C385CDE8","content":"Aoo test(vector<Aoo>& a) {\n","styles":[],"attachments":[]},{"id":"94180CCF-8F23-4759-80C4-FAEB332335B2","content":"  Aoo ret = a.back();  \/\/ copy_con_2. 定义时初始化调用拷贝构造，而非赋值构造\n","styles":[],"attachments":[]},{"id":"570AFEDD-35B8-4073-9E04-8B16636CCFD9","content":"\n","styles":[],"attachments":[]},{"id":"6020922D-39D9-4798-9D49-D48DCD1BB5CD","content":"  print(\"1\", ptrToInt(&ret));  \/\/ 与run()中的地址相同\n","styles":[],"attachments":[]},{"id":"228C0F6D-0020-4E76-9226-45EE42EC2A74","content":"\n","styles":[],"attachments":[]},{"id":"82DD8DC4-7E6B-47DF-900C-2FCC7A754873","content":"  {\n","styles":[],"attachments":[]},{"id":"4DB0DFD4-969B-4255-A694-4FD5E87100B3","content":"    Aoo e = std::move(a.back());  \/\/ move_copy_con_3\n","styles":[],"attachments":[]},{"id":"C48166FB-3CD4-4AB4-9528-0EB8EF7E3F30","content":"    \/\/ decon_3\n","styles":[],"attachments":[]},{"id":"25CCE6EC-A885-496C-8EE8-E038F464BAF7","content":"  }\n","styles":[],"attachments":[]},{"id":"0C98B772-A648-4F8E-9E7C-618A2406D457","content":"\n","styles":[],"attachments":[]},{"id":"B177A455-3A73-45DA-ACEE-138B82E6EABD","content":"  a.pop_back(); \/\/ decon_1\n","styles":[],"attachments":[]},{"id":"44AE0633-31E2-4BAE-BEAE-9C906EC9832B","content":"  return ret;\n","styles":[],"attachments":[]},{"id":"19E7ECA1-C838-42DB-9978-569E4E67DDAD","content":"}\n","styles":[],"attachments":[]},{"id":"C9FE8578-C1E4-4C33-B9E9-8BA17A520D7E","content":"\n","styles":[],"attachments":[]},{"id":"CF0F3EB5-5492-4384-9BCF-5BB90B70434D","content":"run() {\n","styles":[],"attachments":[]},{"id":"D822C176-A404-4352-B20C-3319FAAECF40","content":"  vector<Aoo> a;\n","styles":[],"attachments":[]},{"id":"93452CC4-63FE-41D0-99B0-26DC2A0BC3A1","content":"  a.emplace_back();  \/\/ con_1\n","styles":[],"attachments":[]},{"id":"5794D4BC-20C0-42BD-AD29-B90FA4D6BE4D","content":"  Aoo e = test(a);\n","styles":[],"attachments":[]},{"id":"4D662B2C-9203-4C55-AD09-B6EBECECFC8E","content":"  print(\"2\", ptrToInt(&e));  \/\/ test()中的ret直接用了e的空间\n","styles":[],"attachments":[]},{"id":"E2B01FFC-E1F6-41AC-8C80-3DBC726BD5DD","content":"  \/\/ decon_2\n","styles":[],"attachments":[]},{"id":"0AE39B42-4448-4D15-88A0-B3CF62F4EA70","content":"}","styles":[],"attachments":[]}]},"type":"code","name":"E1CB22C5-0274-4EE5-BD6D-194E45CA03C6. 2","location":0}]}]}